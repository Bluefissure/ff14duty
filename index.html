<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
</head>
<style>
    html,
    body {
        height: 99%;
        margin: 10;
        padding: 10;
        overflow: hidden;
    }
</style>

<body>
    <div id="div" style="height:100%;">
        <IFRAME id="iframe" src="" width=98% height=98% scrolling=yes
            ALLOWTRANSPARENCY="false"></IFRAME>
        <div id="info" style="width: 350px; height: auto; position: absolute; left: 0; top: 60px; right: 0; bottom: 0; margin: auto;">
            <div style="text-align:center; display:block; background-color: rgba(255,255,255,0.8); border-radius: 30px; padding: 1rem;">
              <p>随机副本攻略小助手</p>
                <ul>
                  <li>进本后会显示对应副本攻略。</li>
                  <li>通过 /e duty 命令手动开关悬浮窗。</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script type="text/javascript" src="./common.min.js"></script>
    <script>
        let questIdSet = new Set([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 97, 101, 102, 110, 111, 112, 113, 114, 115, 119, 120, 134, 135, 136, 137, 138, 139, 140, 141, 150, 168, 169, 170, 171, 172, 182, 183, 184, 186, 187, 188, 189, 193, 196, 219, 220, 221, 223, 224, 235, 236, 238, 239, 240, 241, 242, 243, 244, 247, 252, 253, 254, 255, 262, 263, 264, 278, 279, 280, 281, 284, 285, 286, 287, 288, 289, 290, 291, 474, 475, 536, 537, 538, 539, 550, 584, 585, 587, 588, 589, 590, 595, 596, 597, 611, 636, 637, 638, 649, 651, 652, 653, 655, 656, 657, 658, 659, 661, 666, 667, 676, 682, 684, 687, 689, 690, 692, 693, 694, 700, 714, 715, 717, 718, 719, 726, 728, 729]);
        let zoneIdMap = {
            142: 81,
            143: 83,
            150: 32,
            151: 111,
            157: 4,
            158: 8,
            159: 10,
            160: 17,
            161: 3,
            162: 7,
            163: 9,
            164: 2,
            166: 6,
            167: 14,
            168: 11,
            169: 1,
            170: 12,
            171: 13,
            172: 5,
            174: 92,
            188: 30,
            189: 29,
            190: 43,
            191: 46,
            192: 47,
            193: 107,
            194: 108,
            195: 109,
            196: 110,
            202: 56,
            206: 57,
            207: 66,
            208: 58,
            214: 42,
            215: 44,
            216: 45,
            217: 15,
            219: 49,
            220: 48,
            221: 50,
            222: 51,
            223: 52,
            224: 16,
            241: 93,
            242: 94,
            243: 95,
            244: 96,
            245: 97,
            281: 72,
            292: 59,
            293: 60,
            294: 61,
            295: 63,
            296: 64,
            297: 65,
            298: 53,
            299: 54,
            300: 55,
            332: 62,
            348: 68,
            349: 18,
            350: 19,
            353: 70,
            354: 71,
            355: 98,
            356: 99,
            357: 100,
            358: 101,
            359: 73,
            360: 21,
            361: 23,
            362: 20,
            363: 22,
            364: 67,
            365: 25,
            366: 76,
            367: 26,
            368: 74,
            369: 75,
            371: 27,
            372: 102,
            373: 24,
            374: 77,
            375: 78,
            376: 127,
            377: 79,
            378: 80,
            380: 103,
            381: 104,
            382: 105,
            383: 106,
            387: 28,
            389: 491,
            390: 492,
            391: 493,
            394: 82,
            396: 85,
            403: 282,
            416: 31,
            417: 481,
            420: 33,
            421: 34,
            426: 84,
            430: 35,
            431: 130,
            432: 86,
            434: 36,
            435: 39,
            436: 88,
            437: 90,
            438: 38,
            441: 37,
            442: 112,
            443: 113,
            444: 114,
            445: 115,
            446: 87,
            447: 89,
            448: 91,
            449: 116,
            450: 117,
            451: 118,
            452: 119,
            506: 561,
            508: 120,
            509: 69,
            510: 40,
            511: 41,
            512: 131,
            514: 132,
            515: 133,
            516: 141,
            517: 134,
            519: 140,
            520: 136,
            521: 137,
            522: 138,
            523: 139,
            524: 135,
            525: 143,
            527: 145,
            529: 147,
            530: 148,
            531: 149,
            532: 150,
            533: 167,
            537: 151,
            538: 152,
            539: 153,
            540: 154,
            541: 155,
            542: 156,
            543: 157,
            544: 158,
            545: 159,
            546: 160,
            547: 161,
            548: 162,
            549: 163,
            550: 164,
            551: 165,
            552: 166,
            554: 180,
            555: 171,
            556: 168,
            557: 172,
            558: 179,
            559: 169,
            560: 173,
            561: 174,
            562: 175,
            563: 176,
            564: 177,
            565: 178,
            566: 170,
            571: 181,
            572: 182,
            576: 183,
            577: 184,
            578: 196,
            579: 195,
            580: 186,
            581: 187,
            582: 188,
            583: 189,
            584: 190,
            585: 191,
            586: 192,
            587: 193,
            589: 197,
            590: 198,
            591: 199,
            592: 194,
            593: 204,
            594: 205,
            595: 206,
            596: 207,
            597: 208,
            598: 209,
            599: 210,
            600: 211,
            601: 212,
            602: 213,
            603: 214,
            604: 215,
            605: 216,
            606: 217,
            607: 218,
            615: 219,
            616: 235,
            617: 221,
            619: 201,
            623: 240,
            624: 202,
            625: 203,
            626: 238,
            627: 220,
            630: 225,
            632: 228,
            633: 222,
            637: 223,
            638: 224,
            644: 230,
            646: 233,
            656: 234,
            660: 241,
            661: 242,
            662: 262,
            663: 236,
            665: 237,
            674: 243,
            677: 244,
            679: 239,
            684: 269,
            688: 246,
            689: 247,
            690: 275,
            691: 252,
            692: 253,
            693: 254,
            694: 255,
            695: 256,
            696: 257,
            697: 258,
            698: 259,
            705: 261,
            706: 270,
            707: 245,
            708: 248,
            709: 249,
            710: 250,
            711: 251,
            712: 268,
            713: 267,
            714: 273,
            715: 271,
            716: 272,
            717: 260,
            718: 266,
            719: 263,
            720: 264,
            722: 265,
            723: 274,
            725: 276,
            729: 277,
            730: 278,
            731: 279,
            732: 283,
            733: 280,
            734: 281,
            741: 473,
            742: 284,
            743: 285,
            745: 476,
            746: 290,
            748: 286,
            749: 287,
            750: 288,
            751: 289,
            752: 292,
            753: 293,
            754: 294,
            755: 295,
            758: 291,
            761: 474,
            762: 475,
            763: 581,
            765: 478,
            766: 479,
            767: 580,
            768: 536,
            769: 582,
            770: 540,
            771: 541,
            772: 542,
            773: 544,
            774: 546,
            775: 548,
            776: 550,
            777: 539,
            778: 537,
            779: 538,
            782: 543,
            783: 545,
            784: 547,
            785: 549,
            788: 584,
            789: 585,
            790: 583,
            791: 599,
            792: 600,
            793: 611,
            794: 586,
            795: 598,
            796: 619,
            797: 609,
            798: 587,
            799: 588,
            800: 589,
            801: 590,
            802: 591,
            803: 592,
            804: 593,
            805: 594,
            806: 595,
            810: 596,
            811: 597,
            821: 649,
            822: 659,
            823: 651,
            824: 637,
            825: 638,
            826: 636,
            827: 639,
            830: 648,
            831: 650,
            832: 640,
            834: 646,
            836: 656,
            837: 676,
            838: 652,
            840: 655,
            841: 661,
            845: 657,
            846: 666,
            847: 687,
            848: 667,
            849: 653,
            850: 684,
            851: 682,
            852: 689,
            853: 654,
            854: 685,
            855: 683,
            856: 690,
            858: 658,
            859: 681,
            860: 680,
            873: 678,
            874: 679,
            875: 691,
            876: 686,
            879: 688,
            882: 700,
            884: 692,
            885: 693,
            887: 694,
            888: 701,
            893: 702,
            894: 703,
            897: 717,
            898: 714,
            899: 705,
            900: 721,
            901: 722,
            902: 715,
            903: 719,
            904: 726,
            905: 728,
            906: 716,
            907: 720,
            908: 727,
            909: 729,
            912: 718,
            914: 724
        }
        let display = false;
        addOverlayListener("ChangeZone", (e) => {
            let zoneId = e.zoneID;
            display = false;
            if (zoneId in zoneIdMap && questIdSet.has(zoneIdMap[zoneId])) {
                let iframe = document.getElementById('iframe');
                let info = document.getElementById('info');
                info.style.visibility = 'hidden';
                let questId = zoneIdMap[zoneId];
                iframe.src = "https://ff14.org/duty/" + questId + ".htm";
                display = true;
            }
            displayOrHideOverlay();
        });
        addOverlayListener("LogLine", (e) => {
            if (e.line[2] === "0038" && e.line[4] === "duty") {
                display = !display;
            }
            displayOrHideOverlay();
        });
        startOverlayEvents();

        function displayOrHideOverlay() {
            let div = document.getElementById('div');
            if (display)
                div.style.visibility = 'visible';
            else
                div.style.visibility = 'hidden';
        }
    </script>
</body>

</html>